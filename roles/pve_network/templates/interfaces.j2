{% set ip_suffix = ((ansible_default_ipv4.address.split('.')[-1]) | int)  %}


auto lo
iface lo inet loopback

iface wlp90s0 inet manual

iface enp87s0 inet manual

auto vmbr0
iface vmbr0 inet static
        address 192.168.8.{{ ip_suffix }}/24
        gateway 192.168.8.1
        bridge-ports enp87s0
        bridge-stp off
        bridge-fd 0

iface enp89s0 inet manual
        mtu 9000

auto internalbr
iface internalbr inet static
        address 192.168.4.{{ ip_suffix }}/24
        bridge-ports enp89s0
        bridge-stp off
        bridge-fd 0
        mtu 9000

auto enp2s0f0np0
iface enp2s0f0np0 inet manual
    ovs_type OVSPort
    ovs_bridge cephbr
    ovs_mtu 9000
    ovs_options other_config:rstp-enable=true other_config:rstp-path-cost=150 other_config:rstp-port-admin-edge=false other_config:rstp-port-auto-edge=false other_config:rstp-port-mcheck=true vlan_mode=native-untagged

auto enp2s0f1np1 inet manual
iface enp2s0f1np1
    ovs_type OVSPort
    ovs_bridge cephbr
    ovs_mtu 9000
    ovs_options other_config:rstp-enable=true other_config:rstp-path-cost=150 other_config:rstp-port-admin-edge=false other_config:rstp-port-auto-edge=false other_config:rstp-port-mcheck=true vlan_mode=native-untagged

    auto cephbr
iface cephbr inet static
    address 172.16.0.{{ ip_suffix }}/24
    ovs_type OVSBridge
    ovs_mtu 9000
    ovs_ports enp2s0f0np0 enp2s0f1np1
    up ovs-vsctl set Bridge ${IFACE} rstp_enable=true other_config:rstp-priority=32768 other_config:rstp-forward-delay=4 other_config:rstp-max-age=6
    post-up sleep 10
